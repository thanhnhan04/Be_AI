# üîå H∆Ø·ªöNG D·∫™N T√çCH H·ª¢P H·ªÜ TH·ªêNG RECOMMENDATION V√ÄO EXPERIENCE PLATFORM

## üìã T·ªïng Quan T√≠ch H·ª£p

H∆∞·ªõng d·∫´n n√†y gi√∫p b·∫°n t√≠ch h·ª£p h·ªá th·ªëng AI Recommendation v√†o h·ªá th·ªëng Experience hi·ªán t·∫°i c·ªßa b·∫°n.

---

## üéØ Y√äU C·∫¶U H·ªÜ TH·ªêNG

### **Backend Experience c·ªßa b·∫°n c·∫ßn c√≥:**
- ‚úÖ Database l∆∞u experiences (MongoDB/PostgreSQL/MySQL)
- ‚úÖ User authentication system
- ‚úÖ API endpoints cho experiences
- ‚úÖ Tracking user interactions (view, click, bookmark, etc.)

### **Recommendation System c·∫ßn:**
- ‚úÖ MongoDB (ƒë√£ c√†i)
- ‚úÖ Python 3.8+ (ƒë√£ c√≥ 3.13)
- ‚úÖ FastAPI server (ƒëang ch·∫°y port 8000)

---

## üèóÔ∏è KI·∫æN TR√öC T√çCH H·ª¢P

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FRONTEND (React/Vue/Angular)              ‚îÇ
‚îÇ  - Experience List                                           ‚îÇ
‚îÇ  - Experience Detail                                         ‚îÇ
‚îÇ  - Recommendation Widget                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
               ‚îÇ                 ‚îÇ                             ‚îÇ
               ‚ñº                 ‚ñº                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  EXPERIENCE BACKEND  ‚îÇ  ‚îÇ  AUTH SERVICE   ‚îÇ  ‚îÇ  RECOMMENDATION API  ‚îÇ
‚îÇ  (Your System)       ‚îÇ  ‚îÇ  (Your System)  ‚îÇ  ‚îÇ  (This AI System)    ‚îÇ
‚îÇ                      ‚îÇ  ‚îÇ                 ‚îÇ  ‚îÇ                      ‚îÇ
‚îÇ  - CRUD Experiences  ‚îÇ  ‚îÇ  - Login        ‚îÇ  ‚îÇ  - GET /recommend    ‚îÇ
‚îÇ  - Search/Filter     ‚îÇ  ‚îÇ  - Register     ‚îÇ  ‚îÇ  - POST /interact    ‚îÇ
‚îÇ  - Booking           ‚îÇ  ‚îÇ  - JWT Token    ‚îÇ  ‚îÇ  - POST /train       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                           ‚îÇ                    ‚îÇ
       ‚ñº                           ‚ñº                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         DATABASES                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Experiences DB  ‚îÇ  ‚îÇ  Users DB    ‚îÇ  ‚îÇ  Interactions   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ (Your DB)       ‚îÇ  ‚îÇ  (Your DB)   ‚îÇ  ‚îÇ  (MongoDB)      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä C·∫§U TR√öC D·ªÆ LI·ªÜU C·∫¶N ƒê·ªíNG B·ªò

### **1. Collection `experiences` trong MongoDB**

**C√°ch 1: Sync t·ª´ DB c·ªßa b·∫°n sang MongoDB (Recommended)**
```python
# Script sync t·ª´ PostgreSQL/MySQL ‚Üí MongoDB
import pymongo
import psycopg2  # ho·∫∑c mysql.connector

# Connect to your DB
your_db = psycopg2.connect(...)
cursor = your_db.cursor()
cursor.execute("SELECT id, name, category, rating, review_count FROM experiences")

# Connect to MongoDB
mongo_client = pymongo.MongoClient("mongodb://localhost:27017")
db = mongo_client["recommend_experiences"]

# Sync data
for row in cursor:
    db.experiences.update_one(
        {"business_id": row[0]},  # experience_id
        {"$set": {
            "business_id": row[0],
            "name": row[1],
            "categories": row[2],
            "stars": row[3],
            "review_count": row[4]
        }},
        upsert=True
    )
```

**C√°ch 2: Webhook realtime (Advanced)**
```python
# Trong Experience Backend c·ªßa b·∫°n
# M·ªói khi create/update experience ‚Üí g·ªçi API n√†y

import httpx

async def sync_experience_to_recommendation(experience_data):
    async with httpx.AsyncClient() as client:
        await client.post(
            "http://localhost:8000/api/sync/experience",
            json={
                "business_id": experience_data["id"],
                "name": experience_data["name"],
                "categories": experience_data["category"],
                "stars": experience_data["rating"],
                "review_count": experience_data["review_count"]
            }
        )
```

### **2. Collection `interactions` tracking**

**Khi user t∆∞∆°ng t√°c v·ªõi experience, g·ªçi API:**
```javascript
// Frontend code
const trackInteraction = async (experienceId, interactionType) => {
  const token = localStorage.getItem('jwt_token');
  
  await fetch('http://localhost:8000/api/interactions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      experience_id: experienceId,
      interaction_type: interactionType  // 'view', 'click', 'wishlist', 'booking'
    })
  });
};

// S·ª≠ d·ª•ng
trackInteraction('exp_123', 'view');      // User xem experience
trackInteraction('exp_123', 'click');     // User click v√†o detail
trackInteraction('exp_123', 'wishlist');  // User add to wishlist
trackInteraction('exp_123', 'booking');   // User book experience
```

---

## üîê X√ÅC TH·ª∞C (AUTHENTICATION)

### **Option 1: Shared JWT (Recommended)**

**B∆∞·ªõc 1:** C·∫•u h√¨nh c√πng SECRET_KEY
```env
# File .env c·ªßa Recommendation System
SECRET_KEY="same_secret_key_with_your_main_system"
ALGORITHM="HS256"
```

**B∆∞·ªõc 2:** Frontend g·ª≠i c√πng 1 JWT token
```javascript
// Token t·ª´ h·ªá th·ªëng Experience c·ªßa b·∫°n
const token = localStorage.getItem('jwt_token');

// G·ª≠i cho c·∫£ 2 backends
await fetch('https://your-experience-api.com/api/experiences', {
  headers: { 'Authorization': `Bearer ${token}` }
});

await fetch('http://localhost:8000/api/recommendations', {
  headers: { 'Authorization': `Bearer ${token}` }
});
```

### **Option 2: Separate Authentication**

**B∆∞·ªõc 1:** User login v√†o h·ªá th·ªëng Experience ‚Üí l·∫•y token
```javascript
const loginResponse = await fetch('https://your-api.com/auth/login', {
  method: 'POST',
  body: JSON.stringify({ email, password })
});
const mainToken = loginResponse.token;
```

**B∆∞·ªõc 2:** D√πng mainToken ƒë·ªÉ l·∫•y recommendation token
```javascript
const recResponse = await fetch('http://localhost:8000/api/auth/exchange-token', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${mainToken}` }
});
const recToken = recResponse.token;
```

---

## üé® FRONTEND INTEGRATION

### **1. Component: Recommendation Widget**

```jsx
// RecommendationWidget.jsx
import React, { useEffect, useState } from 'react';

const RecommendationWidget = ({ userId }) => {
  const [recommendations, setRecommendations] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchRecommendations = async () => {
      try {
        const token = localStorage.getItem('jwt_token');
        const response = await fetch(
          'http://localhost:8000/api/recommendations?top_k=10',
          {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          }
        );
        const data = await response.json();
        setRecommendations(data.recommendations);
      } catch (error) {
        console.error('Failed to fetch recommendations:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchRecommendations();
  }, [userId]);

  if (loading) return <div>Loading recommendations...</div>;

  return (
    <div className="recommendation-widget">
      <h2>üéØ G·ª£i √Ω cho b·∫°n</h2>
      <div className="recommendation-grid">
        {recommendations.map(exp => (
          <ExperienceCard
            key={exp.experience_id}
            id={exp.experience_id}
            name={exp.name}
            rating={exp.stars}
            categories={exp.categories}
            aiScore={exp.score}
          />
        ))}
      </div>
    </div>
  );
};

export default RecommendationWidget;
```

### **2. Tracking User Interactions**

```jsx
// ExperienceDetail.jsx
import { useEffect } from 'react';
import { trackInteraction } from '../services/recommendation';

const ExperienceDetail = ({ experienceId }) => {
  // Track view khi user v√†o trang
  useEffect(() => {
    trackInteraction(experienceId, 'view');
  }, [experienceId]);

  const handleAddToWishlist = () => {
    // Th√™m v√†o wishlist trong DB c·ªßa b·∫°n
    addToWishlist(experienceId);
    
    // Track cho recommendation system
    trackInteraction(experienceId, 'wishlist');
  };

  const handleBooking = () => {
    // X·ª≠ l√Ω booking trong h·ªá th·ªëng c·ªßa b·∫°n
    processBooking(experienceId);
    
    // Track cho recommendation system
    trackInteraction(experienceId, 'booking');
  };

  return (
    <div>
      <h1>{experience.name}</h1>
      <button onClick={handleAddToWishlist}>üíô Wishlist</button>
      <button onClick={handleBooking}>üéüÔ∏è Book Now</button>
    </div>
  );
};
```

### **3. Service Layer**

```javascript
// services/recommendation.js
const RECOMMENDATION_API = 'http://localhost:8000/api';

export const trackInteraction = async (experienceId, interactionType, rating = null) => {
  try {
    const token = localStorage.getItem('jwt_token');
    const response = await fetch(`${RECOMMENDATION_API}/interactions`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        experience_id: experienceId,
        interaction_type: interactionType,
        rating: rating
      })
    });
    
    if (!response.ok) {
      console.warn('Failed to track interaction');
    }
  } catch (error) {
    // Silent fail - kh√¥ng ·∫£nh h∆∞·ªüng UX
    console.error('Interaction tracking error:', error);
  }
};

export const getRecommendations = async (topK = 10) => {
  const token = localStorage.getItem('jwt_token');
  const response = await fetch(
    `${RECOMMENDATION_API}/recommendations?top_k=${topK}`,
    {
      headers: { 'Authorization': `Bearer ${token}` }
    }
  );
  return response.json();
};
```

---

## üîÑ DATA SYNCHRONIZATION

### **Script 1: Initial Data Import**

```python
# scripts/import_from_your_db.py
"""
Import experiences t·ª´ database hi·ªán t·∫°i sang MongoDB
Ch·∫°y 1 l·∫ßn khi setup
"""
import pymongo
import psycopg2  # ho·∫∑c mysql.connector, ho·∫∑c SQLAlchemy

# Config
YOUR_DB_CONFIG = {
    'host': 'localhost',
    'database': 'experience_db',
    'user': 'postgres',
    'password': 'your_password'
}

MONGO_URL = "mongodb://localhost:27017"
MONGO_DB = "recommend_experiences"

def import_experiences():
    # Connect to your database
    conn = psycopg2.connect(**YOUR_DB_CONFIG)
    cursor = conn.cursor()
    
    # Connect to MongoDB
    mongo_client = pymongo.MongoClient(MONGO_URL)
    db = mongo_client[MONGO_DB]
    
    # Query experiences
    cursor.execute("""
        SELECT 
            id,
            name,
            category,
            rating,
            review_count,
            city,
            state
        FROM experiences
        WHERE is_active = true
    """)
    
    count = 0
    for row in cursor:
        db.businesses.update_one(
            {"business_id": str(row[0])},
            {"$set": {
                "business_id": str(row[0]),
                "name": row[1],
                "categories": row[2],
                "stars": float(row[3]) if row[3] else 0.0,
                "review_count": int(row[4]) if row[4] else 0,
                "city": row[5],
                "state": row[6]
            }},
            upsert=True
        )
        count += 1
        if count % 100 == 0:
            print(f"Imported {count} experiences...")
    
    print(f"‚úÖ Imported {count} experiences successfully!")
    
    cursor.close()
    conn.close()
    mongo_client.close()

if __name__ == "__main__":
    import_experiences()
```

### **Script 2: Incremental Sync (Daily/Hourly)**

```python
# scripts/sync_experiences_daily.py
"""
Sync experiences m·ªõi/updated t·ª´ DB ‚Üí MongoDB
Ch·∫°y theo schedule (cron job/celery)
"""
from datetime import datetime, timedelta
import pymongo
import psycopg2

def sync_updated_experiences(last_sync_time):
    conn = psycopg2.connect(**YOUR_DB_CONFIG)
    cursor = conn.cursor()
    
    mongo_client = pymongo.MongoClient(MONGO_URL)
    db = mongo_client[MONGO_DB]
    
    # Query experiences updated sau last_sync_time
    cursor.execute("""
        SELECT id, name, category, rating, review_count
        FROM experiences
        WHERE updated_at > %s
    """, (last_sync_time,))
    
    count = 0
    for row in cursor:
        db.businesses.update_one(
            {"business_id": str(row[0])},
            {"$set": {
                "business_id": str(row[0]),
                "name": row[1],
                "categories": row[2],
                "stars": float(row[3]),
                "review_count": int(row[4]),
                "synced_at": datetime.now()
            }},
            upsert=True
        )
        count += 1
    
    print(f"‚úÖ Synced {count} updated experiences")
    
    cursor.close()
    conn.close()
    mongo_client.close()

# Ch·∫°y m·ªói gi·ªù
if __name__ == "__main__":
    last_sync = datetime.now() - timedelta(hours=1)
    sync_updated_experiences(last_sync)
```

---

## üîß BACKEND INTEGRATION

### **Option 1: Microservices (Recommended)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Experience API   ‚îÇ         ‚îÇ Recommendation API   ‚îÇ
‚îÇ (Port 3000)      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ (Port 8000)          ‚îÇ
‚îÇ                  ‚îÇ  HTTP   ‚îÇ                      ‚îÇ
‚îÇ - CRUD Exp       ‚îÇ         ‚îÇ - GET recommend      ‚îÇ
‚îÇ - Booking        ‚îÇ         ‚îÇ - POST interaction   ‚îÇ
‚îÇ - Search         ‚îÇ         ‚îÇ - POST train         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**G·ªçi t·ª´ Experience Backend:**
```python
# experience_backend/services/recommendation.py
import httpx

RECOMMENDATION_API = "http://localhost:8000/api"

async def get_recommendations_for_user(user_id: str, top_k: int = 10):
    """L·∫•y recommendations t·ª´ AI service"""
    async with httpx.AsyncClient() as client:
        response = await client.get(
            f"{RECOMMENDATION_API}/recommendations",
            params={"top_k": top_k},
            headers={"X-User-ID": user_id}  # ho·∫∑c JWT token
        )
        return response.json()

async def track_user_interaction(user_id: str, exp_id: str, action: str):
    """Track interaction v√†o recommendation system"""
    async with httpx.AsyncClient() as client:
        await client.post(
            f"{RECOMMENDATION_API}/interactions",
            json={
                "experience_id": exp_id,
                "interaction_type": action
            },
            headers={"X-User-ID": user_id}
        )
```

### **Option 2: Single Backend v·ªõi SDK**

```python
# experience_backend/app.py
from fastapi import FastAPI
from recommendation_sdk import RecommendationClient

app = FastAPI()
rec_client = RecommendationClient("http://localhost:8000")

@app.get("/api/experiences/{exp_id}")
async def get_experience(exp_id: str, user_id: str):
    # L·∫•y experience t·ª´ DB c·ªßa b·∫°n
    experience = await db.experiences.find_one({"id": exp_id})
    
    # Track view
    await rec_client.track("view", user_id, exp_id)
    
    # L·∫•y similar experiences
    similar = await rec_client.get_similar(exp_id, top_k=5)
    
    return {
        "experience": experience,
        "similar_experiences": similar
    }
```

---

## üìÖ TRAINING & RETRAINING

### **Setup 1: Manual Retrain (Khi c√≥ ƒë·ªß data m·ªõi)**

```bash
# Khi c√≥ 1000+ interactions m·ªõi
curl -X POST http://localhost:8000/api/training/preprocess
curl -X POST http://localhost:8000/api/training/train
```

### **Setup 2: Scheduled Retrain (T·ª± ƒë·ªông)**

**Cron Job (Linux/Mac):**
```bash
# Retrain m·ªói tu·∫ßn (Sunday 2 AM)
0 2 * * 0 curl -X POST http://localhost:8000/api/training/train
```

**Windows Task Scheduler:**
```powershell
# T·∫°o task ch·∫°y m·ªói tu·∫ßn
$trigger = New-ScheduledTaskTrigger -Weekly -DaysOfWeek Sunday -At 2am
$action = New-ScheduledTaskAction -Execute "curl" -Argument "-X POST http://localhost:8000/api/training/train"
Register-ScheduledTask -TaskName "RetrainALS" -Trigger $trigger -Action $action
```

**Celery (Python):**
```python
# tasks.py
from celery import Celery
import httpx

app = Celery('tasks', broker='redis://localhost:6379')

@app.task
def retrain_recommendation_model():
    """Retrain model h√†ng tu·∫ßn"""
    client = httpx.Client()
    
    # Preprocess
    client.post('http://localhost:8000/api/training/preprocess')
    
    # Train
    response = client.post('http://localhost:8000/api/training/train')
    
    return response.json()

# Schedule: M·ªói Sunday 2 AM
app.conf.beat_schedule = {
    'retrain-weekly': {
        'task': 'tasks.retrain_recommendation_model',
        'schedule': crontab(hour=2, minute=0, day_of_week=0)
    }
}
```

---

## üöÄ DEPLOYMENT

### **Production Setup**

**1. Deploy Recommendation API:**
```bash
# Docker
docker build -t recommendation-api .
docker run -d -p 8000:8000 \
  -e MONGODB_URL="mongodb://mongo:27017" \
  -e SECRET_KEY="your_production_secret" \
  recommendation-api

# ho·∫∑c v·ªõi Docker Compose
docker-compose up -d
```

**2. Reverse Proxy (Nginx):**
```nginx
# /etc/nginx/sites-available/your-domain
server {
    listen 443 ssl;
    server_name api.yourdomain.com;

    # Experience API
    location /api/experiences {
        proxy_pass http://localhost:3000;
    }

    # Recommendation API
    location /api/recommendations {
        proxy_pass http://localhost:8000;
    }
    
    location /api/interactions {
        proxy_pass http://localhost:8000;
    }
}
```

**3. Environment Variables:**
```env
# Production .env
MONGODB_URL=mongodb://production-mongo:27017
MONGODB_DB_NAME=recommend_experiences
SECRET_KEY=your_super_secret_key_production
REDIS_HOST=production-redis
REDIS_PORT=6379
CORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
DEBUG=False
```

---

## ‚úÖ CHECKLIST T√çCH H·ª¢P

### **Phase 1: Setup (1-2 ng√†y)**
- [ ] C√†i ƒë·∫∑t MongoDB local
- [ ] Import experiences t·ª´ DB c·ªßa b·∫°n ‚Üí MongoDB
- [ ] Test Recommendation API v·ªõi Postman/curl
- [ ] C·∫•u h√¨nh CORS cho frontend domain

### **Phase 2: Authentication (1 ng√†y)**
- [ ] Setup shared SECRET_KEY ho·∫∑c token exchange
- [ ] Test authentication flow
- [ ] Verify JWT token t·ª´ frontend ‚Üí backend

### **Phase 3: Frontend Integration (2-3 ng√†y)**
- [ ] T·∫°o RecommendationWidget component
- [ ] Implement interaction tracking (view, click, wishlist, booking)
- [ ] Test recommendations hi·ªÉn th·ªã ƒë√∫ng
- [ ] Handle loading states & errors

### **Phase 4: Data Sync (1-2 ng√†y)**
- [ ] Vi·∫øt script sync experiences (initial + incremental)
- [ ] Setup cron job/scheduled task
- [ ] Test data consistency

### **Phase 5: Training (1 ng√†y)**
- [ ] Thu th·∫≠p √≠t nh·∫•t 500+ interactions
- [ ] Ch·∫°y training l·∫ßn ƒë·∫ßu
- [ ] Verify model metrics (Hit Rate@10)
- [ ] Setup auto-retrain schedule

### **Phase 6: Testing & Optimization (2-3 ng√†y)**
- [ ] A/B test recommendations vs random
- [ ] Monitor API response time
- [ ] Setup Redis caching
- [ ] Load testing

### **Phase 7: Production Deploy (1-2 ng√†y)**
- [ ] Deploy Docker containers
- [ ] Setup Nginx reverse proxy
- [ ] Configure production environment
- [ ] Monitor logs & errors

**Total: ~10-14 ng√†y**

---

## üìû API ENDPOINTS CHO INTEGRATION

### **1. Get Recommendations**
```
GET /api/recommendations?top_k=10
Authorization: Bearer {jwt_token}

Response:
{
  "user_id": "user_123",
  "recommendations": [...],
  "total": 10,
  "model": "ALS"
}
```

### **2. Track Interaction**
```
POST /api/interactions
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
  "experience_id": "exp_456",
  "interaction_type": "view",
  "rating": 4.5  // optional
}

Response: {"status": "success"}
```

### **3. Get Similar Experiences**
```
GET /api/recommendations/similar/{experience_id}?top_k=5
Authorization: Bearer {jwt_token}

Response:
{
  "experience_id": "exp_456",
  "similar": [...]
}
```

### **4. Retrain Model**
```
POST /api/training/train
Authorization: Bearer {admin_token}

Response:
{
  "status": "success",
  "metrics": {
    "hit_rate": 0.346
  }
}
```

---

## üêõ TROUBLESHOOTING

### **Problem 1: CORS Error**
```
Error: Access to fetch has been blocked by CORS policy
```
**Solution:**
```env
# .env
CORS_ORIGINS=http://localhost:3000,https://yourdomain.com
```

### **Problem 2: Empty Recommendations**
```
{"recommendations": [], "total": 0}
```
**Solution:**
- Check MongoDB c√≥ data kh√¥ng
- Verify model ƒë√£ train ch∆∞a
- Check user_id c√≥ trong training data kh√¥ng

### **Problem 3: Slow Response**
```
Response time > 2 seconds
```
**Solution:**
- Enable Redis caching
- Optimize MongoDB indexes
- Use CDN for API

---

## üìö RESOURCES

- **API Documentation:** http://localhost:8000/docs
- **Code Examples:** `examples/` folder
- **Training Guide:** `SYSTEM_EXPLANATION.md`
- **Support:** Create GitHub issue

---

üéâ **Ch√∫c b·∫°n t√≠ch h·ª£p th√†nh c√¥ng!**
